<div class="checkout-container">
  <h1>Checkout</h1>

  <div class="checkout-content">
    
    <!-- Left Column: Forms -->
    <div class="checkout-forms">
      
      <!-- Delivery Method -->
      <mat-card class="section-card">
        <mat-card-header>
          <mat-card-title>Delivery Method</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-radio-group [(ngModel)]="isPickup" class="radio-group">
            <mat-radio-button [value]="false">Shipping</mat-radio-button>
            <mat-radio-button [value]="true">Pickup</mat-radio-button>
          </mat-radio-group>
        </mat-card-content>
      </mat-card>

      <!-- Shipping Address (Hidden if Pickup) -->
      <div *ngIf="!isPickup">
        <h3>Shipping Address</h3>
        <div class="card-grid">
           <!-- Saved Addresses -->
           <mat-card *ngFor="let addr of addresses" 
                     class="selectable-card" 
                     [class.selected]="selectedAddressId === addr.id"
                     (click)="selectAddress(addr.id)">
             <mat-card-content>
                <div class="card-header-row">
                    <strong>{{addr.fullName}}</strong>
                    <button mat-icon-button (click)="$event.stopPropagation(); openAddressDialog(addr)">
                        <mat-icon>edit</mat-icon>
                    </button>
                </div>
                <p>{{addr.addressLine1}}</p>
                <p *ngIf="addr.addressLine2">{{addr.addressLine2}}</p>
                <p>{{addr.city}}, {{addr.state}} {{addr.zipCode}}</p>
                <p>{{addr.country}}</p>
             </mat-card-content>
           </mat-card>
           
           <!-- Add New Address Card -->
           <mat-card class="add-new-card" (click)="openAddressDialog()">
             <mat-card-content class="add-new-content">
                <mat-icon>add_circle_outline</mat-icon>
                <span>Add New Address</span>
             </mat-card-content>
           </mat-card>
        </div>
      </div>

      <!-- Payment Method -->
      <div>
        <h3>Payment Method</h3>
        <div class="card-grid">
           <!-- Saved Cards -->
           <mat-card *ngFor="let pm of paymentMethods" 
                     class="selectable-card"
                     [class.selected]="selectedPaymentMethodId === pm.id"
                     (click)="selectPayment(pm.id)">
             <mat-card-content>
                <div class="card-header-row">
                    <strong>{{pm.cardType}}</strong>
                    <!-- Pass typed object, simplified for demo editing -->
                    <button mat-icon-button (click)="$event.stopPropagation(); openPaymentDialog(pm)">
                        <mat-icon>edit</mat-icon>
                    </button>
                </div>
                <p>{{pm.cardHolder}}</p>
                <p>**** **** **** {{pm.last4}}</p>
                <p>Expires: {{pm.expiryDate}}</p>
             </mat-card-content>
           </mat-card>

           <!-- Add New Card -->
           <mat-card class="add-new-card" (click)="openPaymentDialog()">
             <mat-card-content class="add-new-content">
                <mat-icon>credit_card</mat-icon>
                <span>Add New Card</span>
             </mat-card-content>
           </mat-card>
        </div>
      </div>

    </div>

    <!-- Right Column: Order Summary -->
    <div class="order-summary">
       <mat-card class="summary-card">
         <mat-card-header>
           <mat-card-title>Order Summary</mat-card-title>
         </mat-card-header>
         <mat-card-content>
           <div class="summary-items">
             <div *ngFor="let item of cartItems" class="summary-item">
               <span>{{item.product.name}} (x{{item.quantity}})</span>
               <span>${{(item.product.retailPrice * item.quantity) | number:'1.2-2'}}</span>
             </div>
           </div>
           <hr>
           <div class="summary-total">
             <strong>Total</strong>
             <strong>${{totalAmount | number:'1.2-2'}}</strong>
           </div>
         </mat-card-content>
         <mat-card-actions>
            <button mat-raised-button color="primary" class="place-order-btn" (click)="placeOrder()" [disabled]="processing">
              <mat-spinner *ngIf="processing" diameter="20"></mat-spinner>
              <span *ngIf="!processing">Place Order</span>
            </button>
         </mat-card-actions>
       </mat-card>
    </div>

  </div>
</div>

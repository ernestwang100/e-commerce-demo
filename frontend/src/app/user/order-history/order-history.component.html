<div class="order-history-container">
  <h1>Order History</h1>

  <div *ngIf="loading" class="loading">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <div *ngIf="error" class="error">
    <mat-icon>error</mat-icon>
    {{ error }}
  </div>

  <div *ngIf="!loading && orders.length === 0 && !error" class="empty">
    <mat-icon>receipt_long</mat-icon>
    <p>You haven't placed any orders yet</p>
  </div>

  <div *ngIf="!loading && orders.length > 0" class="orders-list">
    <mat-card *ngFor="let order of orders" class="order-card">
      <mat-card-header (click)="toggleExpand(order.orderId)">
        <mat-card-title>
          Order #{{ order.orderId }}
          <mat-chip-list>
            <mat-chip [ngClass]="getStatusClass(order.orderStatus)">
              {{ order.orderStatus }}
            </mat-chip>
          </mat-chip-list>
        </mat-card-title>
        <mat-card-subtitle>
          {{ order.datePlaced | date:'medium' }}
        </mat-card-subtitle>
        <div class="order-summary">
          <span class="item-count">{{ order.items.length }} item(s)</span>
          <span class="order-total">${{ getOrderTotal(order) | number:'1.2-2' }}</span>
          <mat-icon>{{ expandedOrderId === order.orderId ? 'expand_less' : 'expand_more' }}</mat-icon>
        </div>
      </mat-card-header>

      <mat-card-content *ngIf="expandedOrderId === order.orderId" class="order-details">
        <table class="items-table">
          <thead>
            <tr>
              <th>Product</th>
              <th>Price</th>
              <th>Qty</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of order.items">
              <td>{{ item.productName }}</td>
              <td>${{ item.purchasedPrice | number:'1.2-2' }}</td>
              <td>{{ item.quantity }}</td>
              <td>${{ (item.purchasedPrice * item.quantity) | number:'1.2-2' }}</td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="3"><strong>Total</strong></td>
              <td><strong>${{ getOrderTotal(order) | number:'1.2-2' }}</strong></td>
            </tr>
          </tfoot>
        </table>
        
        <div class="order-actions" *ngIf="order.orderStatus?.toLowerCase() === 'processing'">
          <button mat-stroked-button color="warn" (click)="cancelOrder(order.orderId)">
            <mat-icon>cancel</mat-icon> Cancel Order
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
